{% load i18n %}
<div class="clearfix">
	<ul class="stats">
		{% for alias, info in databases %}
			<li>
				<strong>{{ alias }}</strong>
				<span>{{ info.time_spent|floatformat:"2" }} ms ({% blocktrans count info.queries as num %}{{ num }} query{% plural %}{{ num }} queries{% endblocktrans %})</span>
			</li>
		{% endfor %}
	</ul>
</div>

<table>
	<thead>
		<tr>
			<th class="query" colspan="2">{% trans 'Query' %}</th>
			<th class="timeline">{% trans 'Timeline' %}</th>
			<th class="time">{% trans 'Time (ms)' %}</th>
			<th class="actions">{% trans "Action" %}</th>
		</tr>
	</thead>
	<tbody>
		{% for query in queries %}
			<tr class="djDebugHoverable {% cycle 'djDebugOdd' 'djDebugEven' %}{% if query.is_slow %} djDebugRowWarning{% endif %}">
				<td class="toggle">
					<a class="djSQLToggleDetails" href="javascript:void(0)">+</a>
				</td>
				<td class="query">
					<div class="djDebugSqlWrap">
						<div class="djDebugSql">{{ query.sql|safe }}</div>
						{% if query.stacktrace %}
						<div class="djSQLDetailsDiv" style="display:none;">
							<p><strong>Connection:</strong> {{ query.alias }}</p>
							<pre>{{ query.stacktrace }}</pre>
							{% if query.template_info %}
							<table>
								{% for line in query.template_info.context %}
								<tr>
									<td>{{ line.num }}</td>
									<td><code style="font-family: monospace;{% if line.highlight %}background-color: lightgrey{% endif %}">{{ line.content }}</code></td>
								</tr>
								{% endfor %}
							</table>
							<p><strong>{{ query.template_info.name|default:"(unknown)" }}</strong></p>
							{% endif %}
						</div>
						{% endif %}
					</div>
				</td>
				<td class="timeline">
					<div class="djDebugTimeline"><div class="djDebugLineChart{% if query.is_slow %} djDebugLineChartWarning{% endif %}" style="left:{{ query.start_offset }}%;"><strong style="width:{{ query.width_ratio }}%;">{{ query.width_ratio }}%</strong></div></div>
				</td>
				<td class="time">
					{{ query.duration|floatformat:"2" }}
				</td>
				<td class="actions">
				{% if query.params %}
					{% if query.is_select %}
						<a class="remoteCall" href="/__debug__/sql_select/?sql={{ query.raw_sql|urlencode }}&amp;params={{ query.params|urlencode }}&amp;duration={{ query.duration|floatformat:"2"|urlencode }}&amp;hash={{ query.hash }}">Sel</a>
						<a class="remoteCall" href="/__debug__/sql_explain/?sql={{ query.raw_sql|urlencode }}&amp;params={{ query.params|urlencode }}&amp;duration={{ query.duration|floatformat:"2"|urlencode }}&amp;hash={{ query.hash }}">Expl</a>
						{% if is_mysql %}
							<a class="remoteCall" href="/__debug__/sql_profile/?sql={{ query.raw_sql|urlencode }}&amp;params={{ query.params|urlencode }}&amp;duration={{ query.duration|floatformat:"2"|urlencode }}&amp;hash={{ query.hash }}">Prof</a>
						{% endif %}
					{% endif %}
				{% endif %}
				</td>
			</tr>
		{% endfor %}
	</tbody>
</table>
